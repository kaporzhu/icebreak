{% extends "page.html" %}
{% load static %}

{% block extracss_compressed %}
<link rel="stylesheet" href="{% static 'css/order.css' %}">
{% endblock %}

{% block extracss %}
<link rel="stylesheet" href="{% static 'libs/jquery-ui/css/smoothness/jquery-ui-1.10.4.custom.min.css' %}">
{% endblock %}

{% block extrajs_compress %}
<script src="{% static 'js/order-staff.js' %}"></script>
{% endblock %}

{% block extrajs %}
<script src="{% static 'libs/jquery-ui/js/jquery-ui-1.10.4.custom.min.js' %}"></script>
<script src="{% static 'libs/jquery-ui/js/jquery.ui.datepicker-zh-TW.js' %}"></script>
{% endblock %}

{% block title %}店铺的所有订单{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-12 well-shadow">
            <div class="row">
                <h4>店铺的所有订单</h4>
                <hr />
                <form class="form-inline">
                    <div class="form-group">
                        <select name="building" class="form-control input-sm">
                            <option value="all">所有写字楼</option>
                            {% for bd in buildings %}
                                {% if building == bd.id|lower %}
                                <option selected="selected" value="{{ bd.id }}">{{ bd.name }}</option>
                                {% else %}
                                <option value="{{ bd.id }}">{{ bd.name }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <select name="status" class="form-control input-sm">
                            <option value="all">所有状态</option>
                            {% for choice in STATUS_CHOICES %}
                                {% if status == choice.0 %}
                                <option selected="selected" value="{{ choice.0 }}">{{ choice.1 }}</option>
                                {% else %}
                                <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <select name="delivery_time" class="form-control input-sm">
                            <option value="all">所有时段</option>
                            {% for time in delivery_times %}
                                {% if time.time == delivery_time %}
                                <option selected="selected" value="{{ time.time }}">{{ time.time }}</option>
                                {% else %}
                                <option value="{{ time.time }}">{{ time.time }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <input class="form-control input-sm datepicker" value="{{ start }}" name="start" /> -
                        <input class="form-control input-sm datepicker" value="{{ end }}" name="end" />
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-sm">查询</button>
                    </div>
                </form>
                <br />
                <div class="btn-group">
                    <button type="button" class="btn btn-default select-rows-btn" data-type="all">全选</button>
                    <button type="button" class="btn btn-default select-rows-btn" data-type="none">全不选</button>
                </div>
                <button type="button" data-update-status-url="{% url 'orders:update_status' %}" data-status="packing done" class="btn btn-default update-status-btn" data-type="all">打包完成</button>
                <button id="print-orders-btn" data-print-orders-url="{% url 'orders:print_orders' %}" data-print-order-foods-url="{% url 'orders:print_order_foods' %}" class="btn btn-default">打印选择的订单</button>
                <table class="table table-bordered table-hover" id="all-orders">
                    <tr>
                        <th></th>
                        <th>套餐</th>
                        <th>配送信息</th>
                        <th>用餐时间</th>
                        <th>下单时间</th>
                        <th>状态</th>
                    </tr>
                    {% for order in object_list %}
                    <tr>
                        <td class="text-center"><input type="checkbox" class="select-row-btn" data-id="{{ order.id }}"></td>
                        <td>
                            <ul class="list-unstyled">
                                {% for order_food in order.orderfood_set.all %}
                                <li>
                                    <span class="food-name">{{ order_food.food }}</span>
                                    <span class="pull-right">&nbsp;&nbsp;{{ order_food.count }}份</span>
                                </li>
                                {% endfor %}
                            </ul>
                        </td>
                        <td>{{ order.address }}<br />{{ order.phone }}, {{ order.name }}</td>
                        <td>{{ order.delivery_time }}</td>
                        <td>{{ order.created_at|date:"m-d H:i" }}</td>
                        <td class="status {{ order.status_color }}">{{ order.get_status_display }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}